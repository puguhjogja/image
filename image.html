<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Face Stamper Generator</title>
    <style>
        /* Global Reset and Aesthetics */
        :root {
            --color-bg: #1a1a2e;
            --color-surface: #2c2c44;
            --color-text: #e0e0e0;
            --color-accent: #4e93d1;
            --color-error: #dc3545;
            --color-success: #28a745;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        h1 {
            color: var(--color-accent);
            text-align: center;
            margin-bottom: 30px;
        }

        /* Layout using CSS Grid for Responsiveness */
      .container {
            display: grid;
            gap: 40px;
            max-width: 1400px;
            margin: 0 auto;
            grid-template-columns: 1fr 1fr; /* Two columns on desktop */
        }

        /* Responsive Layout Collapse */
        @media (max-width: 900px) {
          .container {
                grid-template-columns: 1fr; /* Single column on mobile/tablet */
                padding: 10px;
            }
        }

      .controls,.results {
            padding: 20px;
            background-color: var(--color-surface);
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Input Styling */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--color-accent);
        }

        textarea, input[type="file"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #444;
            border-radius: 6px;
            background-color: #1e1e38;
            color: var(--color-text);
            box-sizing: border-box;
            resize: vertical;
        }

        /* File Input Custom Styling */
        input[type="file"] {
            border: none;
            cursor: pointer;
            padding: 0;
            margin-bottom: 0;
        }

      .file-upload-section {
            padding: 10px;
            border: 2px dashed #4e93d1;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Button Styling */
        button {
            width: 100%;
            padding: 15px;
            background-color: var(--color-accent);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, opacity 0.3s;
        }

        button:hover:not(:disabled) {
            background-color: #3b74a8;
        }

        button:disabled {
            background-color: #6a6a8a;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* Image Display */
      .image-display {
            border: 1px solid #444;
            background-color: #1e1e38;
            min-height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border-radius: 8px;
            margin-top: 15px;
        }

      .image-display img {
            max-width: 100%;
            height: auto;
            display: none; /* Hidden by default until content is loaded */
            border-radius: 8px;
        }
        
        /* Status and Feedback */
        #statusMessage {
            margin-top: 20px;
            padding: 10px;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            min-height: 38px;
        }

      .status-error {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--color-error);
        }

      .status-success {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--color-success);
        }

      .status-loading {
            color: var(--color-accent);
        }
        
    </style>
</head>
<body>

    <h1>AI High-Fidelity Image Generator</h1>

    <div class="container">
        <div class="controls">
            <h2>Generation Input</h2>
            
            <label for="textPromptInput">Text Prompt (Describe Scene and Style)</label>
            <textarea id="textPromptInput" rows="8" placeholder="A high-resolution portrait of a subject, {Emotion}, {Lighting}, photorealistic, detailed texture, using the uploaded face reference. Include details like style, background, and specific actions."></textarea>

            <label for="faceReferenceFile">Upload Reference Face (PNG/JPG, max 5MB)</label>
            <div class="file-upload-section">
                <input type="file" id="faceReferenceFile" accept="image/jpeg, image/png" onchange="handleFileSelect()">
            </div>
            
            <button id="generateButton">Generate High-Fidelity Image</button>

            <div id="statusMessage">Awaiting input...</div>
            
            <h3>Reference Face Preview</h3>
            <div class="image-display">
                <p id="previewPlaceholder">No image selected</p>
                <img id="facePreviewImage" alt="Reference Face Preview">
            </div>
        </div>

        <div class="results">
            <h2>Generated Output</h2>
            <p>The result simulates a high-fidelity output, prioritizing the uploaded face for maximum consistency (Consistency Weight: 0.95).</p>
            <div class="image-display">
                <p id="resultPlaceholder">Generated image will appear here</p>
                <img id="resultImage" alt="Generated Image Result">
            </div>
        </div>
    </div>

    <script>
        // SEGMENT I: GLOBAL DIRECTIVES AND JAVASCRIPT CONSTANTS
        // Configuration Constants
        // NOTE: This is a client-side simulation. To connect to a real AI service, 
        // replace the API_KEY and API_ENDPOINT with real credentials and URLs.
        const API_KEY = 'YOUR_SECURE_API_KEY_PLACEHOLDER'; 
        const API_ENDPOINT = 'https://api.hypothetical-gen.com/v1/generate/face_reference';
        const MAX_FILE_SIZE_BYTES = 5 * 1024 * 1024; // 5 MB limit for Base64 efficiency [1]
        const CONSISTENCY_WEIGHT_DEFAULT = 0.95; // High weight for maximum facial fidelity 

        // DOM Element References
        const promptInput = document.getElementById('textPromptInput');
        const fileInput = document.getElementById('faceReferenceFile');
        const generateBtn = document.getElementById('generateButton');
        const statusDiv = document.getElementById('statusMessage');
        const previewImg = document.getElementById('facePreviewImage');
        const resultImg = document.getElementById('resultImage');
        const previewPlaceholder = document.getElementById('previewPlaceholder');
        const resultPlaceholder = document.getElementById('resultPlaceholder');

        // SEGMENT IV: JAVASCRIPT CORE LOGIC

        /**
         * Utility function to convert a File object to a Base64 Data URI string.
         * Wraps FileReader in a Promise for async/await usage.
         * @param {File} file - The file to convert.
         * @returns {Promise<string>} - A promise that resolves with the Base64 Data URI. [2]
         */
        const toBase64 = (file) => new Promise((resolve, reject) => {
            const reader = new FileReader();
            // reader.readAsDataURL returns the full Data URI (data:image/jpeg;base64,...)
            reader.readAsDataURL(file); 
            reader.onload = () => resolve(reader.result);
            reader.onerror = (error) => reject(error);
        });

        /**
         * Updates the status message div with appropriate styling.
         * @param {string} message - The message to display.
         * @param {string} type - 'loading', 'error', or 'success'. [3]
         */
        const updateStatus = (message, type) => {
            statusDiv.textContent = message;
            statusDiv.className = '';
            statusDiv.classList.add(`status-${type}`);
        };

        /**
         * Handles file selection, client-side validation, and previews the uploaded image.
         */
        const handleFileSelect = () => {
            const file = fileInput.files;

            if (!file) {
                previewImg.style.display = 'none';
                previewPlaceholder.style.display = 'block';
                updateStatus("Awaiting input...", 'loading');
                return;
            }

            // Client-side validation: File Size (Fail Fast principle) [3]
            if (file.size > MAX_FILE_SIZE_BYTES) {
                fileInput.value = ''; // Clear file input
                previewImg.style.display = 'none';
                previewPlaceholder.style.display = 'block';
                return updateStatus(`Error: File exceeds the ${MAX_FILE_SIZE_BYTES / 1024 / 1024}MB limit.`, 'error');
            }

            // Client-side validation: File Type [4]
            const acceptedTypes = ['image/jpeg', 'image/png'];
            if (!acceptedTypes.includes(file.type)) {
                fileInput.value = ''; // Clear file input
                previewImg.style.display = 'none';
                previewPlaceholder.style.display = 'block';
                return updateStatus("Error: Only JPG and PNG files are accepted.", 'error');
            }
            
            // Show image preview using a temporary URL
            previewImg.src = URL.createObjectURL(file);
            previewImg.onload = () => {
                previewPlaceholder.style.display = 'none';
                previewImg.style.display = 'block';
                // Release object URL for memory efficiency after loading
                URL.revokeObjectURL(previewImg.src); 
            };
            
            // Clear status if a valid file is selected
            updateStatus("File ready for processing.", 'success');
        };

        /**
         * Simulates the asynchronous image generation process and API call.
         */
        const generateImage = async (event) => {
            event.preventDefault();

            const prompt = promptInput.value.trim();
            const file = fileInput.files;

            // 1. Pre-flight Checks
            if (!prompt) {
                return updateStatus("Error: Please enter a detailed text prompt.", 'error');
            }
            if (!file) {
                return updateStatus("Error: Please upload a reference face image.", 'error');
            }

            // 2. Set Loading State
            generateBtn.disabled = true;
            resultImg.style.display = 'none';
            resultPlaceholder.style.display = 'block';
            updateStatus("Uploading and Encoding... (1/3)", 'loading');

            try {
                // 3. Data Preparation
                const base64Image = await toBase64(file);
                
                updateStatus("API Call Processing... (2/3) - Simulation Active", 'loading');

                // 4. Mandatory Request Payload Definition (Simulated Data Contract)
                const payload = {
                    api_key: API_KEY, // Authentication simulation [5]
                    prompt: prompt, // Text conditioning
                    reference_image_base64: base64Image, // Facial conditioning data [1]
                    consistency_weight: CONSISTENCY_WEIGHT_DEFAULT, // High weight for fidelity
                    output_settings: {
                        resolution: "1024x1024", // Standard high-quality resolution
                        style: "photorealistic, high detail",
                        format: "image/jpeg"
                    }
                };

                // 5. Network Call Simulation (REPLACE THIS BLOCK WITH REAL fetch() FOR PRODUCTION)
                // Since this is a client-only file, we simulate the network delay and response.
                await new Promise(resolve => setTimeout(resolve, 2000)); 

                // Simulated API Response: Base64 placeholder for a tiny green square image
                const simulatedSuccessBase64 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADFJREFUGFdj/M+Bw4gBl0RzN39gYGBgxMTI5wIeYdEBxMABhCg0FzF+JADUeR8xQ+901QAAAABJRU5ErkJggg==";
                
                // Optional: Simulate an API failure if the user types a specific phrase
                if (prompt.toLowerCase().includes("simulate error")) {
                    throw new Error("Server rejected request: Rate limit exceeded or Invalid generation parameters.");
                }

                // Successful response handling (Simulation)
                const data = { 
                    status: "success", 
                    generated_image_base64: simulatedSuccessBase64 
                };
                
                // 6. Response Processing
                resultImg.src = data.generated_image_base64;
                resultImg.onload = () => {
                    resultPlaceholder.style.display = 'none';
                    resultImg.style.display = 'block';
                    updateStatus("Success: Image generated with high facial fidelity (3/3). (SIMULATION)", 'success');
                };

            } catch (error) {
                // 7. Error Handling (Catch Block) [3]
                console.error("Generation Error:", error);
                // Providing a meaningful error message to the user
                updateStatus(`Operation Failed: ${error.message |

| 'Unknown network error. Check console for details.'}`, 'error');

            } finally {
                // 8. Cleanup (Finally Block)
                generateBtn.disabled = false;
            }
        };

        // Event Listener Attachment
        generateBtn.addEventListener('click', generateImage);
        // handleFileSelect is attached via the 'onchange' attribute in the HTML.
    </script>

</body>
</html>
